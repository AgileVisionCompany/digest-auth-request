!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("digest-auth-request-ts",[],t):"object"==typeof exports?exports["digest-auth-request-ts"]=t():e["digest-auth-request-ts"]=t()}(global,function(){return n={},s.m=o=[function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("request")},function(e,t,o){"use strict";o.r(t);var r=o(1),u=o(0),n=(s.prototype.request=function(e,t,o,n,s){"formRequest"===n?(this.formRequest=!0,this.data=o):"xmlRequest"===n?(this.xmlRequest=!0,this.data=o):o&&(this.data=JSON.stringify(o)),this.successFn=e,this.errorFn=t,this.requestOptions=s,this.nonce?this.makeAuthenticatedRequest(0):this.makeUnauthenticatedRequest()},s);function s(e,t,o,n,s){var i=this;this.makeAuthenticatedRequest=function(n){var e=i.scheme+' username="'+i.username+'", realm="'+i.realm+'", nonce="'+i.nonce+'", uri="'+i.url+'", response="'+i.formulateResponse()+'", '+(i.opaque?'opaque="'+i.opaque+'", ':"")+" qop="+i.qop+", nc="+("00000000"+i.nc).slice(-8)+', algorithm="MD5", cnonce="'+i.cnonce+'"';i.log("digest auth header response to be sent:"),i.log(e),i.log("Authenticated request to "+i.url);try{r(i.url,{method:i.post?"POST":"GET",timeout:36e4,headers:{"Content-type":i.formRequest?"multipart/form-data":i.xmlRequest?'application/soap+xml;charset=UTF-8;action="'+i.requestOptions.action+'"':"application/json",Authorization:e},formData:i.formRequest?i.data:void 0,body:i.formRequest?void 0:i.data},function(e,t,o){e?(i.log('"Error ('+e+") on authenticated request to "+i.url),i.nonce=null,i.errorFn(e)):t&&200<=t.statusCode&&t.statusCode<400?(i.nc++,o&&o.length?i.isJson(o)?i.successFn(JSON.parse(o)):i.successFn(o):i.successFn()):t&&503===t.statusCode&&n<5?setTimeout(function(){i.makeAuthenticatedRequest(n++)},2500):(i.nonce=null,i.errorFn(t.statusCode))})}catch(e){i.errorFn(e)}},this.makeUnauthenticatedRequest=function(){i.log("Unauthenticated request to "+i.url);try{r(i.url,{method:i.post?"POST":"GET",headers:{"Content-type":i.formRequest?"multipart/form-data":i.xmlRequest?'application/soap+xml;charset=UTF-8;action="'+i.requestOptions.action+'"':"application/json"},body:i.formRequest?void 0:i.data},function(e,t,o){if(!e||t&&401===t.statusCode)if(t&&200<=t.statusCode&&t.statusCode<400)i.log("Authentication not required for "+i.url),i.nc++,"undefined"!==o&&o.length?i.isJson(o)?i.successFn(JSON.parse(o)):i.successFn(o):i.successFn();else{var n=t.headers["www-authenticate"];if(null!=n){n=(n=n.slice(n.indexOf(":")+1,-1)).split(","),i.scheme=n[0].split(/\s/)[0];for(var s=0;s<n.length;s++){var r=n[s].indexOf("="),u=n[s].substring(0,r),a=n[s].substring(r+1).replace(/['"]+/g,"");null!=u.match(/realm/i)&&(i.realm=a),null!=u.match(/nonce/i)&&(i.nonce=a),null!=u.match(/opaque/i)&&(i.opaque=a),null!=u.match(/qop/i)&&(i.qop=a)}i.cnonce=function(){for(var e="abcdef0123456789",t="",o=0;o<16;o++){var n=Math.round(Math.random()*e.length);t+=e.substr(n,1)}return t}(),i.nc++,i.log("received headers:"),i.log("\trealm: "+i.realm),i.log("\tnonce: "+i.nonce),i.opaque&&i.log("\topaque: "+i.opaque),i.log("\tqop: "+i.qop),i.makeAuthenticatedRequest(0)}}else i.log('"Error ('+e+") on unauthenticated request to "+i.url),i.errorFn(e)})}catch(e){i.errorFn(e)}},this.formulateResponse=function(){var e=u.createHash("md5").update(i.username+":"+i.realm+":"+i.password).digest("hex"),t=u.createHash("md5").update(i.method+":"+i.url).digest("hex");return u.createHash("md5").update(e+":"+i.nonce+":"+("00000000"+i.nc).slice(-8)+":"+i.cnonce+":"+i.qop+":"+t).digest("hex")},this.isJson=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},this.log=function(e){i.loggingOn&&console.log("[digestAuthRequest] "+e)},this.url=t,this.username=o,this.password=n,this.nc=1,this.formRequest=!1,this.xmlRequest=!1,this.requestOptions={},this.method=e,this.loggingOn=!!s,this.post=!1,"post"!==e.toLowerCase()&&"put"!==e.toLowerCase()||(this.post=!0)}t.default=n}],s.c=n,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(o,n,function(e){return t[e]}.bind(null,n));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=2);function s(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return o[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}var o,n});